<!DOCTYPE html>
<html lang="en">
 <head>
   <meta charset="utf-8">
   <meta content="width=device-width,initial-scale=1" name="viewport">
   <title>Pembayaran - WEB ALFA OFFICIAL</title>
   
   <!-- CSS Asli Website Anda -->
   <link href="https://telegra.ph/file/03478fe1432d994cd1dcd.jpg" rel="icon">
   <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
   <link href="https://api.zeeoneofc.my.id/bootstrap/css/bootstrap.min.css" rel="stylesheet">
   <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
   <link href="https://api.zeeoneofc.my.id/css/style.min.css" rel="stylesheet">
   
   <style>
       body { background-color: #f4f4f4; }
       .payment-container {
           padding-top: 120px;
           padding-bottom: 60px;
           display: flex;
           justify-content: center;
           align-items: center;
           min-height: 100vh;
       }
       .payment-box {
           background-color: #1a1a1a;
           color: #fff;
           padding: 30px;
           border-radius: 10px;
           text-align: center;
           box-shadow: 0 5px 25px rgba(0,0,0,0.5);
           font-family: "Poppins", sans-serif;
           width: 90%;
           max-width: 450px;
       }
       .payment-box h2, .payment-box h3 { font-weight: 700; margin-bottom: 15px; }
       .payment-box .btn-modal { background: #0d6efd; border: 0; padding: 12px 24px; color: #fff; transition: 0.4s; border-radius: 50px; cursor: pointer; width: 100%; margin-bottom: 10px; font-weight: 600; text-transform: uppercase; }
       .payment-box .btn-modal:hover { background: #0b5ed7; }
       .payment-box .btn-modal.whatsapp { background: #25D366; }
       .payment-box .btn-modal.whatsapp:hover { background: #1da851; }
       #qrisImage { max-width: 90%; height: auto; margin: 20px 0; border-radius: 8px; background-color: white; padding: 5px; }
       #paymentInfo, #suksesInfo, #detailProduk { text-align: left; line-height: 1.9; margin: 20px 0; font-size: 15px; }
       #loadingText { font-style: italic; color: #aaa; padding: 40px 0; }
       .hidden { display: none; }
   </style>
 </head>
 <body>
   <header id="header" class="fixed-top d-flex align-items-center header-scrolled" style="background: rgba(1, 4, 13, 0.8);">
     <div class="container d-flex align-items-center justify-content-between">
       <div class="logo"><h1><a href="index.html"><span>ALFA OFFICIAL</span></a></h1></div>
       <nav id="navbar" class="navbar">
           <ul><li><a class="nav-link scrollto" href="index.html">Kembali ke Home</a></li></ul>
       </nav>
     </div>
   </header>
   
   <main id="main">
       <div class="payment-container">
           <div class="payment-box">
               <div id="qrisArea">
                 <h3>Scan untuk Membayar</h3>
                 <p id="loadingText">Membuat permintaan pembayaran...</p>
                 <img id="qrisImage" src="" class="hidden" alt="QRIS Code">
                 <div id="paymentInfo" class="hidden"></div>
               </div>
               <div id="suksesArea" class="hidden">
                 <h2>Pembayaran Berhasil!</h2>
                 <div id="suksesInfo"></div>
                 <button id="kirimBuktiBtn" class="btn-modal whatsapp">Kirim Bukti ke Admin</button>
                 <a href="index.html" class="btn-modal" style="background: #6c757d; text-decoration: none;">Kembali ke Toko</a>
               </div>
           </div>
       </div>
   </main>

   <script>
       // KODE JAVASCRIPT UNTUK HALAMAN INI
       document.addEventListener('DOMContentLoaded', function() {
           const urlParams = new URLSearchParams(window.location.search);
           const produk = urlParams.get('produk');
           const amount = parseInt(urlParams.get('harga'));

           if (!produk || !amount) {
               document.body.innerHTML = "<h1>Data produk tidak valid. Silakan kembali ke halaman utama.</h1>";
               return;
           }
           
           buatPembayaran(produk, amount);
       });

       let paymentInterval;

       async function buatPembayaran(produk, amount) {
           const SETTINGS = {
               QRIS: { apikey: "alfa2025", qrisCode: "00020101021126670016COM.NOBUBANK.WWW01189360050300000879140214140263240266770303UMI51440014ID.CO.QRIS.WWW0215ID20253948029410303UMI5204481253033605802ID5919ANDI CALL OK23853956005BLORA61055821162070703A0163044FEE" },
           };

           const { apikey, qrisCode } = SETTINGS.QRIS;
           const apiUrl = `https://alfaofficial.cloud/orderkuota/createpayment?apikey=${apikey}&amount=${amount}&codeqr=${qrisCode}`;

           try {
               const res = await fetch(apiUrl);
               const json = await res.json();
               if (!json?.result?.idtransaksi || !json?.result?.imageqris?.url) throw new Error('Respons API tidak lengkap.');
               
               const data = json.result;
               
               document.getElementById('loadingText').classList.add('hidden');
               document.getElementById("qrisImage").src = data.imageqris.url;
               document.getElementById("paymentInfo").innerHTML = `<strong>Produk:</strong> ${produk}<br><strong>ID Transaksi:</strong> ${data.idtransaksi}<br><strong>Jumlah:</strong> Rp ${amount.toLocaleString('id-ID')}`;
               document.getElementById('qrisImage').classList.remove('hidden');
               document.getElementById('paymentInfo').classList.remove('hidden');
               
               paymentInterval = setInterval(() => cekStatusPembayaran(data.idtransaksi, produk, amount), 5000);
           } catch (err) {
               console.error("Error:", err);
               document.getElementById('loadingText').innerHTML = 'Gagal membuat pembayaran. Cek konsol (F12) untuk error CORS.';
           }
       }

       async function cekStatusPembayaran(transactionId, produk, amount) {
           const SETTINGS = {
               QRIS: { apikey: "alfa2025", merchantId: "OK2385395", keyorkut: "184646517465972242385395OKCTB1BFD496F29624C01FF8E5728CF69A17" },
               NOMOR_ADMIN_WA: "6282226769163"
           };
           const { apikey, merchantId, keyorkut } = SETTINGS.QRIS;
           const apiUrl = `https://alfaofficial.cloud/orderkuota/cekstatus?apikey=${apikey}&merchant=${merchantId}&keyorkut=${keyorkut}&idtransaksi=${transactionId}`;

           try {
               const res = await fetch(apiUrl);
               const json = await res.json();
               
               if (json?.result?.status === "PAID") {
                   clearInterval(paymentInterval);
                   
                   document.getElementById('qrisArea').classList.add('hidden');
                   document.getElementById('suksesArea').classList.remove('hidden');
                   document.getElementById("suksesInfo").innerHTML = `<strong>Produk:</strong> ${produk}<br><strong>ID Transaksi:</strong> ${transactionId}<br><strong>Jumlah Dibayar:</strong> Rp ${amount.toLocaleString('id-ID')}`;

                   const pesanWA = `Halo Admin, saya telah berhasil melakukan pembayaran untuk:\n\nProduk: *${produk}*\nID Transaksi: *${transactionId}*\nJumlah: *Rp ${amount.toLocaleString('id-ID')}*\n\nMohon untuk segera diproses. Terima kasih.`;
                   const urlWA = `https://wa.me/${SETTINGS.NOMOR_ADMIN_WA}?text=${encodeURIComponent(pesanWA)}`;
                   document.getElementById('kirimBuktiBtn').onclick = () => window.open(urlWA, '_blank');
               } else {
                   console.log("Menunggu pembayaran...");
               }
           } catch (err) {
               console.error("Gagal cek status:", err);
           }
       }
   </script>
 </body>
</html>
